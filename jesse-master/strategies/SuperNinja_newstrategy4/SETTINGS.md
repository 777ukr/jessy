# SuperNinja_newstrategy4 - Конвертированная стратегия newstrategy4 из Freqtrade

## Описание

SuperNinja_newstrategy4 - это конвертированная версия очень сложной стратегии newstrategy4 из Freqtrade с множеством условий входа, DCA (Dollar Cost Averaging) и кастомным стоп-лоссом.

### Особенности стратегии

**Множество условий входа:**
1. **NFINext44**: EWO, CTI, EMA фильтры
2. **NFINext37**: EWO, RSI, CTI
3. **NFINext7**: EMA тренд, CTI
4. **VWAP**: VWAP bands, CTI, RSI
5. **Local uptrend**: EMA тренд, Bollinger Bands
6. **NFIX29**: EWO fast, CTI, EMA

**Управление рисками:**
- Кастомный стоп-лосс с динамической логикой (BB_RPB_TSL)
- Deadfish exit - выход при низкой волатильности и убытке
- DCA (Dollar Cost Averaging) - усреднение позиции до 8 ордеров

**Используемые индикаторы:**
- EWO (Elliott Wave Oscillator) - два варианта
- RSI (быстрый, обычный, медленный, 84, 112)
- EMA (12, 16, 26, 50, 200)
- CTI (Correlation Trend Indicator)
- Bollinger Bands
- VWAP Bands
- Heikin Ashi
- Williams %R
- Chaikin Money Flow (CMF)
- Stochastic RSI
- RMI (Relative Momentum Index)
- CCI
- Fisher Transform

### ✅ ПРОВЕРЕННЫЕ ДАННЫЕ В БАЗЕ

**Доступные данные:**
- **Период:** 2024-11-01 до 2025-11-07 (год данных)
- **Свечей 1m:** 535,552
- **Все периоды из отчета присутствуют:** 202412, 202501, 202502, 202503, 202504, 202505, 202506, 202507

### Основные параметры

**Exchange:** Gate USDT Perpetual  
**Symbol:** BTC-USDT  
**Timeframe:** 5m (как в оригинальной стратегии)  
**Leverage:** 1x (cross margin)  
**Starting Balance:** $10,000

### Период тестирования

**Рекомендуемый период:** 2024-12-01 до 2025-07-31 (8 месяцев)

**Или полный год:** 2024-11-01 до 2025-11-07

**Warmup:** 200+ свечей (достаточно данных есть)

### Настройки комиссий

**Fee:** 0.00016 (0.016% - тейкер комиссия Gate.io)

**Примечание:** Gate.io возвращает 60% комиссий на фьючерсах, что улучшит результаты на ~25% от уплаченных комиссий.

### Параметры стратегии

**Вход (основные):**
- base_nb_candles_buy: 12
- low_offset: 0.985
- rsi_buy: 58

**Выход:**
- base_nb_candles_sell: 22
- high_offset: 1.014
- high_offset_2: 1.01
- sell_fisher: 0.464
- sell_bbmiddle_close: 1.091

**DCA (Dollar Cost Averaging):**
- initial_safety_order_trigger: -1.8%
- max_safety_orders: 8
- safety_order_step_scale: 1.2
- safety_order_volume_scale: 1.4

**Кастомный стоп-лосс:**
- pHSL: -0.397
- pPF_1: 0.012
- pPF_2: 0.07
- pSL_1: 0.015
- pSL_2: 0.068

**Deadfish:**
- sell_deadfish_profit: -0.063
- sell_deadfish_bb_factor: 0.954
- sell_deadfish_bb_width: 0.043
- sell_deadfish_volume_factor: 2.37

### Логика DCA

Стратегия использует Dollar Cost Averaging:
- Первый ордер при входе
- Дополнительные ордера при падении цены на -1.8%, -2.16%, -2.59%, и т.д.
- Размер каждого следующего ордера увеличивается в 1.4 раза
- Максимум 8 ордеров

### Кастомный стоп-лосс

Динамический стоп-лосс в зависимости от прибыли:
- При прибыли > 7%: стоп = прибыль - 6.8%
- При прибыли 1.2-7%: линейная интерполяция между -1.5% и -6.8%
- При прибыли < 1.2%: стоп = -39.7%

### Ожидаемые результаты

На основе оригинальной стратегии newstrategy4:
- Стратегия оптимизирована для частых сделок
- DCA помогает усреднить цену входа
- Множество условий входа увеличивает количество возможных входов
- Кастомный стоп-лосс защищает прибыль

### Отличия от оригинальной стратегии

1. **Упрощены некоторые условия входа** - не все условия реализованы полностью
2. **Информативные таймфреймы** - не реализованы (1h данные)
3. **PMAX индикатор** - не реализован (слишком сложный)
4. **Support/Resistance уровни** - упрощены
5. **DCA логика** - адаптирована для Jesse framework

### Рекомендации

1. Используйте таймфрейм **5m** для лучших результатов
2. Убедитесь, что в базе достаточно данных (минимум 200 свечей для warmup)
3. Стратегия может генерировать много сделок из-за DCA - следите за комиссиями
4. После бектеста используйте калькулятор возврата комиссий для расчета реальной прибыли

### Калькулятор возврата комиссий

```bash
python3 fee_rebate_calculator.py <Total_Paid_Fees> <Net_Profit> <Starting_Balance>
```

Пример:
```bash
python3 fee_rebate_calculator.py 685.40 -595.79 10000
```



