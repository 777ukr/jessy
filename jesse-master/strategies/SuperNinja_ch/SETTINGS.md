# SuperNinja_ch - Конвертированная стратегия ch (ClucHA) из Freqtrade

## Описание

SuperNinja_ch - это конвертированная стратегия ch из Freqtrade, использующая ClucHA (Close Lower Upper Channel Heikin Ashi) условие входа.

### Особенности стратегии

**Условие входа ClucHA (is_ewo):**
- Использует Heikin Ashi свечи
- Bollinger Bands на Heikin Ashi Typical Price
- ROCR (Rate of Change Ratio) для фильтрации
- Два варианта условия входа

**Управление рисками:**
- Кастомный выход по Stochastic Fast
- Deadfish exit при низкой волатильности и убытке
- Выход по времени удержания позиции

### Используемые индикаторы

- **Heikin Ashi**: Для сглаживания цены
- **Bollinger Bands**: На HA Typical Price (40 периодов) и обычные (20 периодов)
- **ROCR**: Rate of Change Ratio (28 и 168 периодов)
- **EMA**: 8, 12, 13, 16, 26, 50 периодов
- **RSI**: Быстрый (4), обычный (14), медленный (20)
- **Stochastic Fast**: Для выхода
- **ADX**: Для определения силы тренда
- **CTI**: Correlation Trend Indicator
- **SMA**: 15 периодов

### ✅ ПРОВЕРЕННЫЕ ДАННЫЕ В БАЗЕ

**Доступные данные:**
- **Период:** 2024-11-01 до 2025-11-07 (год данных)
- **Свечей 1m:** 535,552
- **Все периоды из отчета присутствуют:** 202412, 202501, 202502, 202503, 202504, 202505, 202506, 202507

**Анализ волатильности по месяцам:**
- 202412: диапазон 18.23% (91,517 - 108,199)
- 202501: диапазон 22.50% (89,381 - 109,493)
- 202502: диапазон 31.13% (78,347 - 102,740) ⚠️ самый волатильный
- 202503: диапазон 23.89% (76,598 - 94,894)
- 202504: диапазон 28.15% (74,582 - 95,580)
- 202505: диапазон 19.78% (93,406 - 111,882)
- 202506: диапазон 12.44% (98,288 - 110,517) ✅ наименее волатильный
- 202507: диапазон 17.19% (105,135 - 123,203)

**Общая статистика:**
- Общий диапазон за год: 88.70% (66,805 - 126,064)
- Средняя цена: ~$101,608
- Стандартное отклонение: ~$12,007

### Основные параметры

**Exchange:** Gate USDT Perpetual  
**Symbol:** BTC-USDT  
**Timeframe:** 5m (как в оригинальной стратегии)  
**Leverage:** 1x (cross margin)  
**Starting Balance:** $10,000

### Период тестирования

**Рекомендуемый период:** 2024-12-01 до 2025-07-31 (8 месяцев)

**Или полный год:** 2024-11-01 до 2025-11-07

**Warmup:** 200+ свечей (достаточно данных есть)

### Настройки комиссий

**Fee:** 0.00016 (0.016% - тейкер комиссия Gate.io)

**Примечание:** Gate.io возвращает 60% комиссий на фьючерсах, что улучшит результаты на ~25% от уплаченных комиссий.

### Параметры стратегии

**Вход ClucHA:**
- clucha_bbdelta_close: 0.01889
- clucha_bbdelta_tail: 0.72235
- clucha_close_bblower: 0.0127
- clucha_closedelta_close: 0.00916
- clucha_rocr_1h: 0.79492

**Выход:**
- sell_fastx: 75 (Stochastic Fast для выхода)

**Deadfish:**
- sell_deadfish_profit: -0.05
- sell_deadfish_bb_factor: 1.0
- sell_deadfish_bb_width: 0.05
- sell_deadfish_volume_factor: 1.0

**Управление рисками:**
- Stop Loss: -25%

### Логика входа

**ClucHA условие (is_ewo):**

Условие 1 (основное):
- rocr_1h > 0.79492
- lower.shift() > 0
- bbdelta > ha_close * 0.01889
- closedelta > ha_close * 0.00916
- tail < bbdelta * 0.72235
- ha_close < lower.shift()
- ha_close <= ha_close.shift()

Условие 2 (альтернативное):
- rocr_1h > 0.79492
- ha_close < ema_slow (50)
- ha_close < 0.0127 * bb_lowerband

### Логика выхода

**Кастомный выход:**
1. Если profit > 0 и fastk > 75: выход "sell_fahmi"
2. Если прошло > 60 минут, fastk > 75 и profit > -1%: выход "sell_kalah"
3. Если прошло > 1 день, fastk > 75 и profit > -5%: выход "sell_lama"

**Deadfish Exit:**
- Прибыль < -5%
- BB ширина < 0.05
- Цена > BB middle * 1.0
- Объем 12 < Объем 24 * 1.0

### Ожидаемые результаты

На основе оригинальной стратегии ch:
- Стратегия использует ClucHA для определения точек входа
- Heikin Ashi помогает сгладить шум
- Кастомный выход защищает прибыль
- Deadfish exit помогает избежать длительных убытков

### Отличия от оригинальной стратегии

1. **ROCR 1h**: Используется ROCR на 168 периодах вместо информативного таймфрейма 1h
2. **Упрощены некоторые расчеты**: Некоторые индикаторы упрощены для совместимости
3. **Кастомный выход**: Адаптирован для Jesse framework

### Рекомендации

1. Используйте таймфрейм **5m** для лучших результатов
2. Убедитесь, что в базе достаточно данных (минимум 200 свечей для warmup)
3. Стратегия может генерировать умеренное количество сделок
4. После бектеста используйте калькулятор возврата комиссий для расчета реальной прибыли

### Калькулятор возврата комиссий

```bash
python3 fee_rebate_calculator.py <Total_Paid_Fees> <Net_Profit> <Starting_Balance>
```

Пример:
```bash
python3 fee_rebate_calculator.py 685.40 -595.79 10000
```



